# Gutao_Chaodi 开发日志（对照 `doc/Development_White_Paper.md`）

- 日期：2026-02-18
- 范围：本次已落地代码（`src/`、`tests/`、`scripts/`）
- 对照基线：`doc/Development_White_Paper.md`
- 额外业务修订：根据最新要求，监控对象调整为“全市场股票入池（含 ST），盘中仅在一字跌停条件下执行策略”，ST 退市风险改为人工核验。

## 1. 已完成项

### 1.1 模块 A：配置与环境管理（4.1）
- 已完成 `pydantic-settings` 配置加载与校验：`src/config.py`
- 已实现 `.env` 读取、默认值、类型校验。
- 已提供 `.env.example` 模板，关键字段缺失时会启动失败（Fail-fast）。

### 1.2 模块 C：抗网络抖动采集（4.3）
- 已完成 `aiohttp` 异步请求：`src/fetcher.py`
- 已完成并发限制（`asyncio.Semaphore`）、连接池复用（`TCPConnector`）。
- 已完成 Tenacity 异步重试（重试次数/间隔可配置）。
- 已完成请求随机抖动（Jitter）。

### 1.3 模块 D：领域模型（4.4）
- 已完成 `StockSnapshot`、`PoolStock`、`AlertEvent` 模型：`src/models.py`
- 已实现 `"-"`、空字符串等脏数据清洗为数值，保证策略计算稳定。
- 已约束策略引擎输入为模型对象（非原始 dict）。

### 1.4 模块 E：通知网关与熔断（4.5）
- 已完成 Apprise 通知网关：`src/notifier.py`
- 已完成单次触发机制（one-shot）与 `processed_set` 熔断：`src/engine.py`
- 已完成开板剔除（`high_price > limit_down_price` 直接移出监控）。

### 1.5 主流程与运行
- 已完成主流程编排：`src/main.py`
- 已完成手动启动脚本：`scripts/run_live.sh`
- 已支持 13:00 前启动自动等待，13:00-15:00 轮询运行。
- 已完成基础日志落盘（Loguru，按天轮转与保留）。

### 1.6 测试
- 已完成核心单测：`tests/test_models.py`、`tests/test_engine.py`、`tests/test_pool_manager.py`
- 当前测试结果：`5 passed`。

## 2. 部分完成项

### 2.1 模块 B：股票池构建（4.2）
- 已完成 AkShare + Tushare 数据接入与池构建框架：`src/pool_manager.py`
- 已根据最新业务修订实现全市场入池：
  - 非ST、ST 均纳入监控池
  - ST 仅作为标签，不参与自动过滤
- 部分未齐：
  - 白皮书提到的“上市 > 1年、非退市整理期”规则未完整实现为硬过滤。

### 2.2 可观测性（2.1, 4.5）
- 已有结构化日志与运行摘要。
- 部分未齐：
  - 尚未形成完整指标体系（如每轮耗时、超时率、重试率、告警速率的统一指标输出/看板）。

### 2.3 总体架构（3）
- 已实现“采集 -> 模型 -> 引擎 -> 通知”的主链路。
- 部分未齐：
  - 白皮书中的“显式 Producer-Consumer 内存队列”未单独实现，当前为主循环内直接处理。

## 3. 未完成项（需进一步完善）

### 3.1 云端策略验证（5.1 / 里程碑 Phase 1）
- 未实现 JoinQuant/RiceQuant 回测脚本与参数报告产出流程。
- `VOL_DROP_THRESHOLD` 当前为配置注入，未建立“参数来自云端验证结论”的自动闭环。

### 3.2 生产运行保障增强
- 未实现交易日自动调度（当前为手动启动模式）。
- 未实现进程守护/重启策略（systemd、supervisor、容器编排均未接入）。
- 未实现显式 GC 调优与长期稳定性压测报告（白皮书高可用目标中的内存稳定部分）。

### 3.3 集成测试与演练
- 未完成真实外部接口的联调回放（目前以单测和假数据为主）。
- 未形成“异常注入场景”测试矩阵（限流、抖动、部分字段缺失、接口结构变化）。

## 4. 建议的下一步完善清单（优先级）

1. 补齐股票池硬过滤规则：
- 新增“上市超过 1 年”过滤。
- 明确“是否需要退市整理期自动过滤”。当前按业务口径改为人工核验，不自动剔除 ST。

2. 完成云端回测闭环：
- 在 JoinQuant/RiceQuant 输出阈值评估报告。
- 将回测结论固化到配置版本（带日期和样本说明）。

3. 增强运行可靠性：
- 增加进程守护与自动拉起。
- 增加轮询级别指标统计与健康检查。

4. 补齐集成测试：
- 加入 EastMoney/Tushare/AkShare 的接口契约测试与失败场景回放。

## 5. 备注
- 本次实现遵循最新业务口径：全市场股票入池，盘中命中一字跌停条件才进入策略判定。
- ST 相关风险不自动剔除，交由人工核验。
